<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NyayaNet - Submit Issue</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
#map {
  height: 400px;
  width: 100%;
  margin-top: 1rem;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
.success {
  color: #2e7d32;
  font-weight: bold;
  text-align: center;
  margin-top: 1rem;
}
</style>
</head>
<body>
<header>
  <h1>Welcome to NyayaNet</h1>
  <nav>
    <a href="index.html" class="active">Home</a>
    <a href="view.html">View Issues</a>
    <a href="map.html">Map</a>
    <a href="resources.html">Resources</a>
  </nav>
</header>

<main>
  <div class="form-card">
    <h3>Submit an Issue</h3>
    <form id="issueForm">
      <label>Name:</label>
      <input type="text" id="name" placeholder="Your Name" required>
      <label>Email:</label>
      <input type="email" id="email" placeholder="Your Email" required>
      <label>Issue:</label>
      <textarea id="issue" rows="4" placeholder="Describe the issue..." required></textarea>
      <label>Location / Area:</label>
      <input type="text" id="location" placeholder="Enter your area or city" required>
      <button type="submit">Submit Issue</button>
    </form>
    <p id="message" class="success"></p>
    <div id="map"></div>
  </div>
</main>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// Initialize map
const map = L.map('map').setView([20.5937, 78.9629], 5); // Default: India
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let marker = null;

// Clear any previous submissions or markers
localStorage.removeItem("lastSubmission");

// Predefined coordinates for Indian states and UTs
const locationMap = {
  "andhra pradesh": [15.9129, 79.7400],
  "arunachal pradesh": [28.2180, 94.7278],
  "assam": [26.2006, 92.9376],
  "bihar": [25.0961, 85.3131],
  "chhattisgarh": [21.2787, 81.8661],
  "goa": [15.2993, 74.1240],
  "gujarat": [22.2587, 71.1924],
  "haryana": [29.0588, 76.0856],
  "himachal pradesh": [31.1048, 77.1734],
  "jharkhand": [23.6102, 85.2799],
  "karnataka": [15.3173, 75.7139],
  "kerala": [10.8505, 76.2711],
  "madhya pradesh": [22.9734, 78.6569],
  "maharashtra": [19.7515, 75.7139],
  "manipur": [24.6637, 93.9063],
  "meghalaya": [25.4670, 91.3662],
  "mizoram": [23.1645, 92.9376],
  "nagaland": [26.1584, 94.5624],
  "odisha": [20.9517, 85.0985],
  "punjab": [31.1471, 75.3412],
  "rajasthan": [27.0238, 74.2179],
  "sikkim": [27.5330, 88.5122],
  "tamil nadu": [11.1271, 78.6569],
  "telangana": [17.1232, 79.2088],
  "tripura": [23.9408, 91.9882],
  "uttar pradesh": [26.8467, 80.9462],
  "uttarakhand": [30.0668, 79.0193],
  "west bengal": [22.9868, 87.8550],
  "delhi": [28.6139, 77.2090],
  "jammu": [32.7266, 74.8570],
  "kashmir": [34.0837, 74.7973],
  "ladakh": [34.1526, 77.5770],
  "hyderabad": [17.3850, 78.4867],
  "bangalore": [12.9716, 77.5946],
  "bengaluru": [12.9716, 77.5946],
  "mumbai": [19.0760, 72.8777],
  "pune": [18.5204, 73.8567],
  "kolkata": [22.5726, 88.3639],
  "chennai": [13.0827, 80.2707],
  "lucknow": [26.8467, 80.9462],
  "patna": [25.5941, 85.1376],
  "bhopal": [23.2599, 77.4126],
  "jaipur": [26.9124, 75.7873],
  "ahmedabad": [23.0225, 72.5714],
  "kochi": [9.9312, 76.2673],
  "bhubaneswar": [20.2961, 85.8245],
  "guwahati": [26.1445, 91.7362],
  "imphal": [24.8170, 93.9368],
  "aizawl": [23.7271, 92.7176],
  "shillong": [25.5788, 91.8933],
  "gangtok": [27.3389, 88.6065],
  "dehradun": [30.3165, 78.0322],
  "panaji": [15.4909, 73.8278],
  "chandigarh": [30.7333, 76.7794],
  "agra": [27.1767, 78.0081],
  "varanasi": [25.3176, 82.9739],
  "mysore": [12.2958, 76.6394],
  "madurai": [9.9252, 78.1198],
  "visakhapatnam": [17.6868, 83.2185],
  "vijayawada": [16.5062, 80.6480]
};

// Handle form submission
document.getElementById("issueForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const issueText = document.getElementById("issue").value.trim();
  const locationText = document.getElementById("location").value.trim().toLowerCase();

  if (!name || !email || !issueText || !locationText) {
    alert("Please fill all fields");
    return;
  }

  // Find coordinates
  let lat = 20.5937, lon = 78.9629; // Default: India
  for (const key in locationMap) {
    if (locationText.includes(key)) {
      [lat, lon] = locationMap[key];
      break;
    }
  }

  const newIssue = {
    name, email, issue: issueText, location: locationText,
    lat, lon, time: new Date().toLocaleString()
  };

  localStorage.setItem("lastSubmission", JSON.stringify(newIssue));

  // Success message
  const msg = document.getElementById("message");
  msg.innerText = "âœ… Issue submitted successfully!";
  msg.style.display = "block";

  // Reset form
  document.getElementById("issueForm").reset();

  // Remove old marker and add new
  if (marker) map.removeLayer(marker);
  marker = L.marker([lat, lon])
    .addTo(map)
    .bindPopup(`<b>${issueText}</b><br>${locationText}`)
    .openPopup();
  map.setView([lat, lon], 7);
});
</script>
</body>
</html>
